$sourceFolder = "C:\projects"
$destinationFolder = "F:\projects"

# Create the destination folder if it doesn't exist
if (-not (Test-Path -Path $destinationFolder)) {
    New-Item -ItemType Directory -Path $destinationFolder | Out-Null
}

# Get all files from the source folder and its subfolders
$files = Get-ChildItem -Path $sourceFolder -File -Recurse

foreach ($file in $files) {
    $relativePath = $file.FullName.Substring($sourceFolder.Length + 1)
    $destinationPath = Join-Path -Path $destinationFolder -ChildPath $relativePath

    $destinationFolderForFile = Split-Path -Path $destinationPath
    if (-not (Test-Path -Path $destinationFolderForFile)) {
        New-Item -ItemType Directory -Path $destinationFolderForFile | Out-Null
    }

    # Check if the file already exists in the destination folder
    if (-not (Test-Path -Path $destinationPath)) {
        Copy-Item -Path $file.FullName -Destination $destinationPath
        Write-Host "Copied $($file.FullName) to $($destinationPath)"
    } else {
        Write-Host "Skipped $($file.FullName) (already exists at $($destinationPath))"
    }
}


@echo off
set "sourceFolder=C:\projects"
set "destinationFolder=F:\projects"

if not exist "%destinationFolder%" (
    mkdir "%destinationFolder%"
)

for /r "%sourceFolder%" %%F in (*) do (
    set "relativePath=%%~dpF"
    setlocal enabledelayedexpansion
    set "relativePath=!relativePath:%sourceFolder%=!"
    if not exist "%destinationFolder%!relativePath!" (
        mkdir "%destinationFolder%!relativePath!"
    )
    if not exist "%destinationFolder%!relativePath!%%~nxF" (
        copy "%%F" "%destinationFolder%!relativePath!%%~nxF"
        echo Copied "%%F" to "%destinationFolder%!relativePath!%%~nxF"
    ) else (
        echo Skipped "%%F" (already exists at "%destinationFolder%!relativePath!%%~nxF")
    )
    endlocal
)
